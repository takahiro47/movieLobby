"use strict";var $all,$api,$app,$body,$doc,$mw,$win,Application,MovieListContent,MovieListContentView,MovieListContents,MovieListContentsView,MovieSingleContent,MovieSingleContentView,media,storage,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};$win=$(window),$doc=$(document),$body=$("body"),$all=$("html body"),jQuery.ajax=function(a){var b,c,d,e,f,g;return e=function(a){return!c.test(a)&&/:\/\//.test(a)},f=location.protocol,d=location.hostname,c=RegExp(f+"//"+d),b="http"+(/^https/.test(f)?"s":"")+"://query.yahooapis.com/v1/public/yql?callback=?",g='select * from html where url="{URL}" and xpath="*"',function(c){var d;return d=c.url,/get/i.test(c.type)&&!/json/i.test(c.dataType)&&e(d)&&(c.url=b,c.dataType="json",c.data={q:g.replace("{URL}",d+(c.data?(/\?/.test(d)?"&":"?")+jQuery.param(c.data):"")),format:"xml"},!c.success&&c.complete&&(c.success=c.complete,delete c.complete),c.success=function(a){return function(b){a&&a.call(this,{responseText:(b.results[0]||"").replace(/<script[^>]+?\/>|<script(.|\s)*?\/script>/g,"")},"success")}}(c.success)),a.apply(this,arguments)}}(jQuery.ajax),$api={domain:"//"+$("#data").data("domain")+"/api",account:function(){return $.ajax(""+this.domain+"/account/me.json",{type:"GET",dataType:"jsonp"})}},$mw={domain:"http://movie.walkerplus.com",showing:function(a){return null==a&&(a=1),$.ajax({type:"GET",url:""+this.domain+"/list/"+a+".html",dataType:"html"})},coming:function(){return $.ajax({type:"GET",url:""+this.domain+"/list/coming/",dataType:"html"})},detail:function(a){return $.ajax({type:"GET",url:""+this.domain+"/mv"+a+"/",dataType:"html"})}},storage={get:function(a){return null!=window.localStorage?window.localStorage.getItem(a):!1},set:function(a,b){return null!=window.localStorage?window.localStorage.setItem(a,b):!1}},MovieListContent=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b}(Backbone.Model),MovieListContentView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.className="content-tile type-list col-xs-6",b.prototype.template=_.template($("#tmpl-list-content").html()),b.prototype.events={"click .js-navigate-single":"navigateSingle"},b.prototype.initialize=function(){return this.$el.html(this.template(this.model.toJSON()))},b.prototype.render=function(){var a,b;return this.$el.attr({"data-id":this.model.get("id")}),this.$el.css({"background-image":'url("'+this.model.get("thumbnail")+'")'}),a=new Date,b=this.model.get("release"),this.$(".release-date").text(b.month===a.getMonth()+1&&b.date===a.getDate()?"明日公開":""+b.month+"/"+b.date+"〜"),this},b.prototype.navigateSingle=function(){return $app.navigate("movie.html?id="+this.model.get("id"),!0)},b}(Backbone.View),MovieSingleContent=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b}(Backbone.Model),MovieSingleContentView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.className="content-tile type-single",b.prototype.template=_.template($("#tmpl-single-content").html()),b.prototype.events={},b.prototype.initialize=function(){return this.$el.html(this.template(this.model.toJSON()))},b.prototype.render=function(){return this.$el.attr({"data-id":this.model.get("id")}),this},b}(Backbone.View),MovieListContents=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.model=MovieListContent,b}(Backbone.Collection),MovieListContentsView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.el=$("#content"),b.prototype.template=_.template($("#tmpl-contents").html()),b.prototype.events={},b.prototype.initialize=function(a){return this.collection=a,this.$el.html(this.template()),this.listenTo(this.collection,"reset",this.clear),this.listenTo(this.collection,"add",this.append),this.render()},b.prototype.render=function(){return this},b.prototype.clear=function(){return this.$(".content-tiles").empty()},b.prototype.append=function(a){var b;return"list"===a.get("type")?(b=new MovieListContentView({model:a}).render(),this.$(".content-tiles").append(b.el)):(b=new MovieSingleContentView({model:a}).render(),this.$(".content-tiles").append(b.el))},b}(Backbone.View),Application=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.$title=$("title"),b.prototype.$search=null,b.prototype.fetching=!1,b.prototype.routes={"(?page=:page)":"index","index.html(?page=:page)":"index","coming.html":"coming","movie.html?id=(:id)":"movie_detail"},b.prototype.initialize=function(){return this.navigate(location.pathname,!0),Backbone.history.start({pushState:!0,root:"/movieLobby"}),$(function(){return function(){return media.movieListContentsView=new MovieListContentsView(media.movieListContents)}}(this))},b.prototype.index=function(a){return console.log("映画一覧(公開中)ページ"),$.when($mw.showing(a)).done(function(){return function(a){var b,c,d,e,f,g;for(b=$(a.results[0]).find("#main .onScreenBoxContentMovie"),d=_.map(b,function(a){var b,c;return c=$(a).find(".movieDate dt").text().match(/^([0-9]+)月([0-9]+)日/),b={type:"list",id:$(a).find("h3 a").attr("href").match(/\/mv([0-9]+)\//)[1],title:$(a).find("h3 a").text(),description:$(a).find(".movieInfo p").text(),thumbnail:$(a).find(".moviePhoto img").attr("src"),release:{month:c[1],date:c[2]}}}),console.log(""+d.length+"件の映画データを取得完了"),media.movieListContents.reset(),g=media.movies=d,e=0,f=g.length;f>e;e++)c=g[e],media.movieListContents.add(new MovieListContent(c));return $(".nav__title h1").text("公開中")}}(this)).fail(function(){return function(){return console.log("MovieWalker.comとの通信に失敗しました")}}(this))},b.prototype.showing=function(){},b.prototype.coming=function(){return console.log("映画一覧(近日公開)ページ"),$.when($mw.coming()).done(function(){return function(a){var b,c,d,e,f,g;for(b=$(a.results[0]).find("#comingMovieList .movie"),d=_.map(b,function(a){var b,c,d;return c=$(a).find(".publishDate p").text().match(/^([0-9]+)月([0-9]+)日/),d=$(a).find(".publishDate a span").text().match(/^([0-9]+)人/),b={type:"list",id:$(a).find("h3 a").attr("href").match(/\/mv([0-9]+)\//)[1],title:$(a).find("h3 a").text(),description:$(a).find(".movieInfo p").text(),thumbnail:$(a).find(".movieInner img").attr("src"),wanted:d?d[1]:0,release:{month:c[1],date:c[2]}}}),console.log(""+d.length+"件の映画データを取得完了",d),media.movieListContents.reset(),g=media.movies=d,e=0,f=g.length;f>e;e++)c=g[e],media.movieListContents.add(new MovieListContent(c));return $(".nav__title h1").text("近日公開")}}(this)).fail(function(){return function(){return console.log("MovieWalker.comとの通信に失敗しました")}}(this))},b.prototype.movie_detail=function(a){return console.log("映画詳細ページ id="+a),$.when($mw.detail(a)).done(function(){return function(b){var c,d,e;return c=$(b.results[0]).find("#main"),e=$(c).find("#publishDate p").text().match(/^([0-9]+)月([0-9]+)日/),d={type:"single",id:a,title:$(c).find("#pageHeader h1 a").text(),description:$(c).find("#mainInfo p").text(),thumbnail:$(c).find("#mainImage img").attr("src"),wanted:$(c).find("#mitai_text2").text(),release:{month:e[1],date:e[2]}},console.log("id="+a+"の映画データを取得完了",d),media.movieListContents.reset(),media.movieListContents.add(new MovieListContent(d)),$(".nav__title h1").text(d.title)}}(this)).fail(function(){return function(){return console.log("MovieWalker.comとの通信に失敗しました")}}(this))},b}(Backbone.Router),media={movieListContents:new MovieListContents,next:!1,query:{current:null,page:1}},$app=new Application;