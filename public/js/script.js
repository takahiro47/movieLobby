"use strict";var $all,$api,$app,$body,$doc,$mw,$win,Application,Content,ContentView,Contents,ContentsView,media,storage,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};$win=$(window),$doc=$(document),$body=$("body"),$all=$("html body"),jQuery.ajax=function(a){var b,c,d,e,f,g;return e=function(a){return!c.test(a)&&/:\/\//.test(a)},f=location.protocol,d=location.hostname,c=RegExp(f+"//"+d),b="http"+(/^https/.test(f)?"s":"")+"://query.yahooapis.com/v1/public/yql?callback=?",g='select * from html where url="{URL}" and xpath="*"',function(c){var d;return d=c.url,/get/i.test(c.type)&&!/json/i.test(c.dataType)&&e(d)&&(c.url=b,c.dataType="json",c.data={q:g.replace("{URL}",d+(c.data?(/\?/.test(d)?"&":"?")+jQuery.param(c.data):"")),format:"xml"},!c.success&&c.complete&&(c.success=c.complete,delete c.complete),c.success=function(a){return function(b){a&&a.call(this,{responseText:(b.results[0]||"").replace(/<script[^>]+?\/>|<script(.|\s)*?\/script>/g,"")},"success")}}(c.success)),a.apply(this,arguments)}}(jQuery.ajax),$api={domain:"//"+$("#data").data("domain")+"/api",account:function(){return $.ajax(""+this.domain+"/account/me.json",{type:"GET",dataType:"jsonp"})}},$mw={domain:"http://movie.walkerplus.com",showing:function(){return $.ajax({type:"GET",url:""+this.domain+"/list",dataType:"html"})},coming:function(){return $.ajax({type:"GET",url:""+$api.domain+"/coming",dataType:"html"})}},storage={get:function(a){return null!=window.localStorage?window.localStorage.getItem(a):!1},set:function(a,b){return null!=window.localStorage?window.localStorage.setItem(a,b):!1}},Content=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.defaults={data:{type:""}},b}(Backbone.Model),ContentView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.className="content-tile col-xs-6",b.prototype.template=_.template($("#tmpl-content").html()),b.prototype.events={},b.prototype.initialize=function(){return this.$el.html(this.template(this.model.toJSON()))},b.prototype.render=function(){return this.$el.attr({"data-id":this.model.get("id")}),this.$el.css({"background-image":'url("'+this.model.get("thumbnail")+'")'}),this},b}(Backbone.View),Contents=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.model=Content,b}(Backbone.Collection),ContentsView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.el=$("#content"),b.prototype.template=_.template($("#tmpl-contents").html()),b.prototype.events={},b.prototype.initialize=function(a){return this.collection=a,this.$el.html(this.template()),this.listenTo(this.collection,"reset",this.clear),this.listenTo(this.collection,"add",this.append),this.render()},b.prototype.render=function(){return this},b.prototype.clear=function(){return this.$(".content-tiles").empty()},b.prototype.append=function(a){var b;return b=new ContentView({model:a}).render(),this.$(".content-tiles").append(b.el)},b}(Backbone.View),Application=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.$title=$("title"),b.prototype.$search=null,b.prototype.fetching=!1,b.prototype.routes={"":"index","/coming":"coming"},b.prototype.initialize=function(){return $.when($mw.showing(1)).done(function(a){return function(b){var c,d;return a.navigate(location.pathname,!0),Backbone.history.start({pushState:!0}),c=$(b.results[0]).find("#main .onScreenBoxContentMovie"),d=_.map(c,function(a){var b,c;return c=$(a).find(".movieDate dt").text().match(/^([0-9]+)月([0-9]+)日/),b={id:$(a).find("h3 a").attr("href").match(/\/mv([0-9]+)\//)[1],title:$(a).find("h3 a").text(),description:$(a).find(".movieInfo p").text(),thumbnail:$(a).find(".moviePhoto img").attr("src"),release:{month:c[1],date:c[2]}}}),$(function(){var a,b,c,e;for(media.contentsView=new ContentsView(media.contents),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(media.contents.add(new Content(a)));return e})}}(this)).fail(function(){return function(){return console.log("MovieWalker.comとの通信に失敗しました"),Backbone.history.start({pushState:!0}),$(function(){return media.contentsView=new ContentsView(media.contents)})}}(this))},b.prototype.index=function(){return this.fetch_movie()},b.prototype.fetch_movie=function(){},b}(Backbone.Router),media={contents:new Contents,next:!1,query:{page:1}},$app=new Application;